
\RequirePackage{ifthen}
\RequirePackage{etoolbox}


%%% Options %%%

\def\wpre@font@options{%
    font = {
        choices = {
            cmbr,
            beamer,
            harmony-os,
            sourcehan,
        },
        initial = cmbr
    }%
}


%%% Font choices %%%

\BeforeBeginEnvironment{document}{%
    \usepackage{fontspec}%
%
    \ifthenelse{\equal{\wpre@font}{beamer}}{}{}%
%
    \ifthenelse{\equal{\wpre@font}{cmbr}}{%
        \wpre@font@use@cmbr%
    }{}%
%
    \ifthenelse{\equal{\wpre@font}{harmony-os}}{%
        \usepackage[fontset=none]{ctex}%
        \wpre@font@use@harmony%
        \linespread{1.3}%
    }{}%
%
    \ifthenelse{\equal{\wpre@font}{sourcehan}}{%
        \usepackage[fontset=none]{ctex}%
        \wpre@font@use@sourcehan%
        \linespread{1.3}%
    }{}%
%
    \usepackage[OT1, euler-hat-accent, euler-digits]{eulervm}%
}

\def\wpre@font@use@cmbr{%
    \setmainfont{cmun}[
        Extension=.otf,
        UprightFont=*rm,
        NFSSFamily=cmrm
    ]%
%
    \setsansfont{cmunb}[
        Extension=.otf,
        UprightFont=*mr,
        ItalicFont=*mo,
        BoldFont=*sr,
        BoldItalicFont=*so,
        NFSSFamily=cmbr
    ]%
%
    \setmonofont{cmun}[
        Extension=.otf,
        UprightFont=*tt,
        ItalicFont=*st,
        BoldFont=*tb,
        BoldItalicFont=*tx,
        NFSSFamily=cmtl
    ]%
}

\def\wpre@font@use@harmony{%
    \setmainfont{HarmonyOS_Sans}[
        Extension=.ttf,
        UprightFont=*_Light,
        BoldFont=*_Medium,
        ItalicFont=*_Light_Italic,
        BoldItalicFont=*_Medium_Italic,
        NFSSFamily=hmrm
    ]%
%
    \setsansfont{HarmonyOS_Sans}[
        Extension=.ttf,
        UprightFont=*_Light,
        BoldFont=*_Medium,
        ItalicFont=*_Light_Italic,
        BoldItalicFont=*_Medium_Italic,
        NFSSFamily=hmsans
    ]%
%
    \setCJKmainfont{HarmonyOS_Sans_SC}[
        Extension=.ttf,
        UprightFont=*_Light,
        BoldFont=*_Medium,
        AutoFakeSlant,
        NFSSFamily=hmrm
    ]%
%
    \setCJKsansfont{HarmonyOS_Sans_SC}[
        Extension=.ttf,
        UprightFont=*_Light,
        BoldFont=*_Medium,
        AutoFakeSlant,
        NFSSFamily=hmsans
    ]%
    \setmonofont{FiraMono}[
        Extension=.otf,
        UprightFont=*-Regular,
        BoldFont=*-Medium,
        ItalicFont=*-Oblique,
        BoldItalicFont=*-MediumOblique,
    ]%
}

\def\wpre@font@use@sourcehan{%
    \setmainfont{SourceSans3}[
        Extension=.otf,
        UprightFont=*-Light,
        BoldFont=*-Semibold,
        ItalicFont=*-LightIt,
        BoldItalicFont=*-SemiboldIt,
        NFSSFamily=sourcesans
    ]%
%
    \setsansfont{SourceSans3}[
        Extension=.otf,
        UprightFont=*-Light,
        BoldFont=*-Semibold,
        ItalicFont=*-LightIt,
        BoldItalicFont=*-SemiboldIt,
        NFSSFamily=sourcesans
    ]%
%
    \setCJKmainfont{SourceHanSansSC}[
        Extension=.otf,
        UprightFont=*-Light,
        BoldFont=*-Medium,
        ItalicFont=*-ExtraLight,
        BoldItalicFont=*-Light,
        NFSSFamily=sourcehan
    ]%
%
    \setCJKsansfont{SourceHanSansSC}[
        Extension=.otf,
        UprightFont=*-Light,
        BoldFont=*-Medium,
        ItalicFont=*-ExtraLight,
        BoldItalicFont=*-Light,
        NFSSFamily=sourcehan
    ]%
    \setmonofont{SourceCodePro}[
        Extension=.otf,
        UprightFont=*-Light,
        BoldFont=*-Semibold,
        ItalicFont=*-LightIt,
        BoldItalicFont=*-SemiboldIt,
    ]%
}

%%% Font styles %%%

\setbeamerfont{title}{size=\LARGE}
\setbeamerfont{subtitle}{size=\large}
\setbeamerfont{author}{size=\normalsize}
\setbeamerfont{institute}{size=\small}
\setbeamerfont{date}{size=\small}

\setbeamerfont{page number in head/foot}{size=\footnotesize}

\setbeamerfont{section title}{size=\Large}
\setbeamerfont{section in toc}{size=\large}

\setbeamerfont{subsection title}{size=\Large}

\setbeamerfont{frametitle continuation}{size=\large}
